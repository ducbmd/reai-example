<!DOCTYPE html>
<html lang="en" dir="ltr" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <link rel="stylesheet" th:href="@{/assets/user-settings/user-settings.css}">
</head>

<body>
<main layout:fragment="content">
    <div class="wa-stack">
        <wa-card>
            <h2 class="wa-heading-l">API Key Management</h2>
            <p class="wa-body">Create and manage API keys for programmatic access to your account.</p>
            
            <wa-button 
                variant="brand" 
                onclick="showCreateModal()"
                style="margin-bottom: 2rem;">
                <wa-icon name="plus" slot="prefix">+</wa-icon>
                Create API Key
            </wa-button>

            <div id="api-keys-list" 
                 hx-get="/user-settings/api-keys" 
                 hx-trigger="load, apiKeyCreated from:body, apiKeyDeleted from:body"
                 hx-swap="innerHTML">
                <div style="text-align: center; padding: 2rem;">
                    <wa-spinner></wa-spinner>
                    <p>Loading API keys...</p>
                </div>
            </div>
        </wa-card>
    </div>

    <div id="create-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="wa-heading-m">Create New API Key</h3>
            <form id="create-api-key-form" 
                  hx-post="/user-settings/api-keys" 
                  hx-swap="none"
                  hx-on:htmx:after-request="handleCreateResponse(event)">
                <div class="wa-stack">
                    <wa-input>
                        <label for="apikey-name">API Key Name</label>
                        <input 
                            id="apikey-name"
                            name="name" 
                            placeholder="e.g., My Integration, Production Server" 
                            required>
                    </wa-input>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <wa-button type="button" onclick="hideCreateModal()">Cancel</wa-button>
                        <wa-button type="submit" variant="brand">Create API Key</wa-button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div id="show-key-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="wa-heading-m">API Key Created Successfully!</h3>
            <div class="wa-stack">
                <p><strong>Important:</strong> This is the only time you will see this API key. Please copy it and store it securely.</p>
                <div id="new-api-key-display">
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <wa-button type="button" onclick="hideShowKeyModal()" variant="brand">I've copied the key</wa-button>
                </div>
            </div>
        </div>
    </div>

    <div id="delete-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 class="wa-heading-m">Delete API Key</h3>
            <div class="wa-stack">
                <p>Are you sure you want to delete this API key? This action cannot be undone.</p>
                <div id="delete-key-name"></div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <wa-button type="button" onclick="hideDeleteModal()">Cancel</wa-button>
                    <wa-button type="button" onclick="confirmDelete()" variant="danger">Delete</wa-button>
                </div>
            </div>
        </div>
    </div>
</main>

<th:block layout:fragment="scripts">
    <script th:src="@{/assets/user-settings/user-settings.js}"></script>
</th:block>
</body>
</html> 